<div ui-view="main" class="app-pane">
  <div ui-view="parts" class="sidebar sidebar-1">
    <h3>Parts</h3>
    <div v-for="item in parts" class="part-item"
         v-bind:class="{'active': item === selectedNav}"
         v-on:click="selectPart(item)">
      <label>{{ item.attributes.name }}</label>
    </div>

    <h3>Surfaces</h3>
    <div v-for="item in surfaces" class="part-item"
         v-bind:class="{'active': item === selectedNav}"
         v-on:click="selectSurface(item)">
      <label>{{ item.id }}</label>
    </div>
  </div>
  <galaxy-animation ui-view="sub-parts" class="sidebar sidebar-2" effects="galaxy.in-out" in-out-item="part-item"
                    in-out-stagger=".03">
    <div v-for="item in subNavs" class="part-item"
         v-bind:class="{'active': item === selectedSubPart}"
         v-on:click="activeItem(item)">
      <label>{{ item.attributes.name }}</label>
    </div>
  </galaxy-animation>

  <galaxy-animation class="object-view" effects="galaxy.in-out" in-out-item="image">
    <img class="image" v-if="objectImageURL" v-bind:src="objectImageURL">
  </galaxy-animation>
</div>

<script>
  var state = Scope.import('state');
  var ProductModel = Scope.import('services/product-model.js');
  var product = new ProductModel(7);

  var app = new Vue({
    el: Scope.views[ 'main' ],
    data: {
      subNavs: [],
      parts: [],
      subParts: [],
      surfaces: [],
      materials: [],
      colors: [],
      currentSetup: {},
      objectImageURL: null,
      selectedNav: null,
      selectedPart: null,
      selectedSubPart: null,
      selectedSurface: null,
      selectedMaterial: null,
      selectedColor: null
    },
    methods: {
      selectPart: function (part) {
        this.selectedPart = part;
        this.selectedNav = part;
        var subPart = product.getSubParts(part);

        this.subParts = subPart.items;
        this.selectedSubPart = subPart.selected;

        this.setSubNavs(this.subParts);
      },
      selectSurface: function (surface) {
        this.selectedSurface = surface;
        this.selectedNav = surface;
        var materials = product.getSubParts(surface);

        this.materials = materials.items;
        this.selectedMaterial = materials.selected;

        this.setSubNavs(this.materials);
      },
      selectMaterial: function (material) {
        this.selectedMaterial = material;
        var colors = product.getSubParts(material);
        this.colors = [];
        debugger;
        Vue.nextTick(function () {
          app.colors = colors.items;
          app.selectedColor = colors.selected;
        });
      },
      setSubNavs: function (list) {
        app.subNavs = [];
        Vue.nextTick(function () {
          app.subNavs = list;
        });
      },
      activeItem: function (subPart) {
        this.selectedSubPart = subPart;
        product.activeItem(this.selectedPart, subPart);
      }
    }
  });

  state.onStart = function () {
    console.log(product);
    product.parts.observe(function (parts) {
      app.parts = parts;
    });

    product.surfaces.observe(function (surfaces) {
      app.surfaces = surfaces;
    });

    product.imageURL.observe(function (path) {
      console.log(path);
      app.objectImageURL = null;

      var image = new Image();
      image.onload = function () {
        app.objectImageURL = 'https://apimer.3dimerce.mybit.nl/' + path;
      };
      image.src = 'https://apimer.3dimerce.mybit.nl/' + path;
    });
  }

</script>
